<%+header%>

<h2>Network Settings</h2>

<div id="network-settings">
    <div class="loading">Loading network information...</div>
    <div class="content" style="display: none;">
        <div class="wan-settings">
            <h3>WAN Interface</h3>
            <div class="form-group">
                <label>IP Address:</label>
                <input type="text" id="wan-ipaddr" class="form-control">
            </div>
            <div class="form-group">
                <label>Netmask:</label>
                <input type="text" id="wan-netmask" class="form-control">
            </div>
            <div class="form-group">
                <label>Gateway:</label>
                <input type="text" id="wan-gateway" class="form-control">
            </div>
            <button id="save-wan" class="btn">Save WAN Settings</button>
        </div>

        <div class="lan-settings">
            <h3>LAN Interface</h3>
            <div class="form-group">
                <label>IP Address:</label>
                <input type="text" id="lan-ipaddr" class="form-control">
            </div>
            <div class="form-group">
                <label>Netmask:</label>
                <input type="text" id="lan-netmask" class="form-control">
            </div>
            <button id="save-lan" class="btn">Save LAN Settings</button>
        </div>
    </div>
</div>

<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        function fetchNetworkData() {
            fetch('<%=url("admin/myopenwrt/get_network")%>')
                .then(response => response.json())
                .then(data => {
                    // Fill form with network data
                    if (data.wan) {
                        document.getElementById('wan-ipaddr').value = data.wan.ipaddr || '';
                        document.getElementById('wan-netmask').value = data.wan.netmask || '';
                        document.getElementById('wan-gateway').value = data.wan.gateway || '';
                    }
                    if (data.lan) {
                        document.getElementById('lan-ipaddr').value = data.lan.ipaddr || '';
                        document.getElementById('lan-netmask').value = data.lan.netmask || '';
                    }

                    document.querySelector('.loading').style.display = 'none';
                    document.querySelector('.content').style.display = 'block';
                })
                .catch(error => {
                    console.error('Error fetching network data:', error);
                    document.querySelector('.loading').textContent = 'Error loading network data. Please try again.';
                });
        }

        // Initial fetch
        fetchNetworkData();

        // Handle form submission for WAN
        document.getElementById('save-wan').addEventListener('click', function() {
            const data = {
                section: 'wan',
                options: {
                    ipaddr: document.getElementById('wan-ipaddr').value,
                    netmask: document.getElementById('wan-netmask').value,
                    gateway: document.getElementById('wan-gateway').value
                }
            };

            fetch('<%=url("admin/myopenwrt/update_network")%>', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert('WAN settings updated successfully');
                } else {
                    alert('Failed to update WAN settings');
                }
            })
            .catch(error => {
                console.error('Error updating WAN settings:', error);
                alert('Error updating WAN settings');
            });
        });

        // Handle form submission for LAN
        document.getElementById('save-lan').addEventListener('click', function() {
            const data = {
                section: 'lan',
                options: {
                    ipaddr: document.getElementById('lan-ipaddr').value,
                    netmask: document.getElementById('lan-netmask').value
                }
            };

            fetch('<%=url("admin/myopenwrt/update_network")%>', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert('LAN settings updated successfully');
                } else {
                    alert('Failed to update LAN settings');
                }
            })
            .catch(error => {
                console.error('Error updating LAN settings:', error);
                alert('Error updating LAN settings');
            });
        });
    });
</script>

<%+footer%>